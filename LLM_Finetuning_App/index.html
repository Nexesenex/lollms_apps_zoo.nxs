<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Finetuning App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/web.app.localizer.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8 text-center text-blue-600" data-translate="title">LLM Finetuning App</h1>
        
        <!-- Tab Navigation -->
        <div class="flex justify-center mb-8">
            <button id="downloadBtn" class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-l focus:outline-none focus:shadow-outline" data-translate="downloadButton">Download Model</button>
            <button id="trainBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 focus:outline-none focus:shadow-outline" data-translate="trainButton">Train</button>
            <button id="fuseBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 focus:outline-none focus:shadow-outline" data-translate="fuseButton">Fuse</button>
            <button id="quantizeBtn" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-r focus:outline-none focus:shadow-outline" data-translate="quantizeButton">Quantize</button>
        </div>

        <!-- Download Model Form -->
        <div id="downloadForm" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <h2 class="text-2xl font-bold mb-4" data-translate="downloadTitle">Download Model</h2>
            <form id="downloadModelForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="downloadModelName" data-translate="downloadModelNameLabel">Model Name (Hugging Face path)</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="downloadModelName" type="text" placeholder="e.g., bert-base-uncased" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="downloadTargetDir" data-translate="downloadTargetDirLabel">Target Directory</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="downloadTargetDir" type="text" placeholder="e.g., /path/to/save/model" required>
                </div>
                <div class="flex items-center justify-between">
                    <button class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit" data-translate="startDownloadButton">Download Model</button>
                </div>
            </form>
        </div>

        <div id="trainForm" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="trainTitle">Train</h2>
            <form id="finetuneForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="modelName" data-translate="modelNameLabel">Model Name (Hugging Face path)</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="modelName" type="text" placeholder="e.g., bert-base-uncased" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" data-translate="datasetSourceLabel">Dataset Source</label>
                    <div class="mt-2">
                        <label class="inline-flex items-center">
                            <input type="radio" class="form-radio" name="datasetSource" value="huggingface" checked>
                            <span class="ml-2" data-translate="huggingFaceOption">Hugging Face</span>
                        </label>
                        <label class="inline-flex items-center ml-6">
                            <input type="radio" class="form-radio" name="datasetSource" value="local">
                            <span class="ml-2" data-translate="localOption">Local</span>
                        </label>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="datasetName" data-translate="datasetNameLabel">Dataset Name/Path</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="datasetName" type="text" placeholder="Dataset name or local path" required>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="dataset-format" data-translate="datasetFormatLabel">Dataset Format</label>
                    <select id="dataset-format" name="dataset-format" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" onchange="toggleCustomFormat()">
                        <option value="single_text" data-translate="singleTextOption">Single Text</option>
                        <option value="instruction_input_output" data-translate="instructionInputOutputOption">Instruction-Input-Output</option>
                        <option value="question_answer" data-translate="questionAnswerOption">Question-Answer</option>
                        <option value="custom" data-translate="customOption">Custom</option>
                    </select>
                </div>

                <div id="custom-format-group" class="mb-4" style="display: none;">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="custom-format" data-translate="customFormatLabel">Custom Format</label>
                    <input type="text" id="custom-format" name="custom-format" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="e.g. {field1} {field2}: {field3}">
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="outputModelPath" data-translate="outputModelPathLabel">Output Model Path</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="outputModelPath" type="text" placeholder="Output Model Path" required>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="learningRate" data-translate="learningRateLabel">Learning Rate</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="learningRate" type="number" step="0.0001" value="3e-4" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="numEpochs" data-translate="numEpochsLabel">Number of Epochs</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="numEpochs" type="number" value="3" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="batchSize" data-translate="batchSizeLabel">Batch Size</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="batchSize" type="number" value="4" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="gradAccumSteps" data-translate="gradAccumStepsLabel">Gradient Accumulation Steps</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="gradAccumSteps" type="number" value="4" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="maxGradNorm" data-translate="maxGradNormLabel">Max Gradient Norm</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="maxGradNorm" type="number" step="0.1" value="0.3" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="weightDecay" data-translate="weightDecayLabel">Weight Decay</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="weightDecay" type="number" step="0.001" value="0.001" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="loraAlpha" data-translate="loraAlphaLabel">LoRA Alpha</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="loraAlpha" type="number" value="16" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="loraDropout" data-translate="loraDropoutLabel">LoRA Dropout</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="loraDropout" type="number" step="0.01" value="0.1" required>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="loraR" data-translate="loraRLabel">LoRA R</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="loraR" type="number" value="8" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="maxSeqLength" data-translate="loraRLabel">Max sequence length</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="maxSeqLength" type="number" value="128000" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="maxSeqLength" data-translate="maxSeqLengthLabel">Max sequence length</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="maxSeqLength" type="number" value="128000" required>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="gpuIds" data-translate="gpuIdsLabel">GPU IDs (comma-separated)</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="gpuIds" type="text" placeholder="e.g., 0,1,2">
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="maxMemoryPerGpu" data-translate="maxMemoryPerGpuLabel">Max memory per GPU (e.g., 10GiB)</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="maxMemoryPerGpu" type="text" placeholder="e.g., 10GiB,8GiB">
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="maxCpuMemory" data-translate="maxCpuMemoryLabel">Max CPU memory</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="maxCpuMemory" type="text" placeholder="e.g., 30GiB">
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="fp16" data-translate="fp16Label">Enable FP16 (Mixed Precision)</label>
                    <input class="mr-2 leading-tight" type="checkbox" id="fp16" checked>
                </div>
                                
                <div class="flex items-center justify-between">
                    <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit" data-translate="startTrainingButton">Start Training</button>
                </div>
            </form>
        </div>

        <div id="fuseForm" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="fuseTitle">Fuse</h2>
            <form id="fusionForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="baseModelPath" data-translate="baseModelPathLabel">Base Model Path</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="baseModelPath" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="loraModelPath" data-translate="loraModelPathLabel">LoRA Model Path</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="loraModelPath" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="fusedOutputPath" data-translate="fusedOutputPathLabel">Fused Output Path</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="fusedOutputPath" type="text" required>
                </div>
                <div class="flex items-center justify-between">
                    <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit" data-translate="startFusionButton">Start Fusion</button>
                </div>
            </form>
        </div>

        <div id="quantizeForm" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="quantizeTitle">Quantize</h2>
            <form id="quantizationForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="modelPathQuantize" data-translate="modelPathQuantizeLabel">Model Path</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="modelPathQuantize" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="quantizedOutputPath" data-translate="quantizedOutputPathLabel">Quantized Output Path</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="quantizedOutputPath" type="text" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="quantizationBits" data-translate="quantizationBitsLabel">Quantization Bits</label>
                    <select id="quantizationBits" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                        <option value="8">8-bit</option>
                        <option value="4">4-bit</option>
                    </select>
                </div>
                <div class="flex items-center justify-between">
                    <button class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit" data-translate="startQuantizationButton">Start Quantization</button>
                </div>
            </form>
        </div>
        
        <div id="progressContainer" class="hidden bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
            <h2 class="text-xl font-semibold mb-4" data-translate="progressTitle">Progress</h2>
            <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4">
                <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
            <pre id="logOutput" class="bg-gray-100 p-4 rounded-lg text-sm h-64 overflow-auto"></pre>
        </div>
    </div>

    <script>
        const downloadForm = document.getElementById('downloadForm');
        const trainForm = document.getElementById('trainForm');
        const fuseForm = document.getElementById('fuseForm');
        const quantizeForm = document.getElementById('quantizeForm');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const logOutput = document.getElementById('logOutput');

        const trainBtn = document.getElementById('trainBtn');
        const fuseBtn = document.getElementById('fuseBtn');
        const quantizeBtn = document.getElementById('quantizeBtn');

        let socket;

        function toggleCustomFormat() {
            var formatSelect = document.getElementById('dataset-format');
            var customFormatGroup = document.getElementById('custom-format-group');
            
            if (formatSelect.value === 'custom') {
                customFormatGroup.style.display = 'block';
            } else {
                customFormatGroup.style.display = 'none';
            }
        }

        downloadForm.addEventListener('click', () => {
            downloadForm.style.display = 'block';
            trainForm.style.display = 'none';
            fuseForm.style.display = 'none';
            quantizeForm.style.display = 'none';
        });

        trainBtn.addEventListener('click', () => {
            downloadForm.style.display = 'none';
            trainForm.style.display = 'block';
            fuseForm.style.display = 'none';
            quantizeForm.style.display = 'none';
        });

        fuseBtn.addEventListener('click', () => {
            downloadForm.style.display = 'none';
            trainForm.style.display = 'none';
            fuseForm.style.display = 'block';
            quantizeForm.style.display = 'none';
        });

        quantizeBtn.addEventListener('click', () => {
            downloadForm.style.display = 'none';
            trainForm.style.display = 'none';
            fuseForm.style.display = 'none';
            quantizeForm.style.display = 'block';
        });

        document.getElementById('downloadBtn').addEventListener('click', function() {
            document.getElementById('downloadForm').style.display = 'block';
            document.getElementById('trainForm').style.display = 'none';
            document.getElementById('fuseForm').style.display = 'none';
            document.getElementById('quantizeForm').style.display = 'none';
        });

        // Form submission logic for downloading the model
        document.getElementById('downloadModelForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const modelName = document.getElementById('downloadModelName').value;
            const targetDir = document.getElementById('downloadTargetDir').value;

            try {
                const response = await fetch('/download_model/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model_name: modelName,
                        target_dir: targetDir,
                    }),
                });

                const result = await response.json();

                if (response.ok) {
                    alert(result.message);
                } else {
                    alert(`Error: ${result.detail}`);
                }
            } catch (error) {
                console.error('Error downloading model:', error);
                alert('An error occurred while downloading the model.');
            }
        });

        document.getElementById('finetuneForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const jsonData = {
                model_name: document.getElementById('modelName').value,
                dataset_source: document.querySelector('input[name="datasetSource"]:checked').value,
                dataset_name: document.getElementById('datasetName').value,
                dataset_format: document.getElementById('dataset-format').value,
                custom_format: document.getElementById('custom-format').value,
                output_model_path: document.getElementById('outputModelPath').value,
                learning_rate: parseFloat(document.getElementById('learningRate').value),
                num_train_epochs: parseInt(document.getElementById('numEpochs').value),
                per_device_train_batch_size: parseInt(document.getElementById('batchSize').value),
                gradient_accumulation_steps: parseInt(document.getElementById('gradAccumSteps').value),
                max_grad_norm: parseFloat(document.getElementById('maxGradNorm').value),
                weight_decay: parseFloat(document.getElementById('weightDecay').value),
                lora_alpha: parseInt(document.getElementById('loraAlpha').value),
                lora_dropout: parseFloat(document.getElementById('loraDropout').value),
                lora_r: parseInt(document.getElementById('loraR').value),
                max_seq_length: parseInt(document.getElementById('maxSeqLength').value),
                gpu_ids: document.getElementById('gpuIds').value.trim() !== '' ? document.getElementById('gpuIds').value.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id)): undefined,
                max_memory_per_gpu: document.getElementById('maxMemoryPerGpu').value.trim() !== '' 
                ? document.getElementById('maxMemoryPerGpu').value.split(',').reduce((obj, val, index) => {
                    const trimmedVal = val.trim();
                    if (trimmedVal !== '') {
                        obj[index] = trimmedVal;
                    }
                    return obj;
                }, {})
                : undefined,
                max_cpu_memory: document.getElementById('maxCpuMemory').value.trim() !== '' 
                ? document.getElementById('maxCpuMemory').value.trim()
                : undefined,
                fp16: document.getElementById('fp16').checked

            };

            try {
                const response = await fetch('/train', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(jsonData),
                });
                
                if (response.ok) {
                    progressContainer.classList.remove('hidden');
                    trainForm.style.display = 'none';
                    initWebSocket();
                } else {
                    throw new Error('Training initialization failed');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while starting the training process.');
            }
        });

        document.getElementById('fusionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const jsonData = {
                base_model_path: document.getElementById('baseModelPath').value,
                lora_model_path: document.getElementById('loraModelPath').value,
                output_path: document.getElementById('fusedOutputPath').value
            };

            try {
                const response = await fetch('/fuse', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(jsonData),
                });
                
                if (response.ok) {
                    progressContainer.classList.remove('hidden');
                    fuseForm.style.display = 'none';
                    initWebSocket();
                } else {
                    throw new Error('Fusion initialization failed');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while starting the fusion process.');
            }
        });

        document.getElementById('quantizationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const jsonData = {
                model_path: document.getElementById('modelPathQuantize').value,
                output_path: document.getElementById('quantizedOutputPath').value,
                quantization_bits: parseInt(document.getElementById('quantizationBits').value)
            };

            try {
                const response = await fetch('/quantize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(jsonData),
                });
                
                if (response.ok) {
                    progressContainer.classList.remove('hidden');
                    quantizeForm.style.display = 'none';
                    initWebSocket();
                } else {
                    throw new Error('Quantization initialization failed');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while starting the quantization process.');
            }
        });

        function initWebSocket() {
            socket = new WebSocket('ws://localhost:8000/ws');
            
            socket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                updateProgress(data);
            };
            socket.onclose = () => {
                console.log('WebSocket connection closed');
            };
        }

        function updateProgress(data) {
            if (data.progress !== undefined) {
                progressBar.style.width = `${data.progress}%`;
            }
            if (data.log) {
                logOutput.textContent += data.log + '\n';
                logOutput.scrollTop = logOutput.scrollHeight;
            }
        }

        const translations = {
            en: {
                name: "English",
                translations: {
                    "title": "LLM Finetuning App",
                    "trainButton": "Train",
                    "fuseButton": "Fuse",
                    "quantizeButton": "Quantize",
                    "trainTitle": "Train",
                    "fuseTitle": "Fuse",
                    "quantizeTitle": "Quantize",
                    "modelNameLabel": "Model Name (Hugging Face path)",
                    "datasetSourceLabel": "Dataset Source",
                    "huggingFaceOption": "Hugging Face",
                    "localOption": "Local",
                    "datasetNameLabel": "Dataset Name/Path",
                    "datasetFormatLabel": "Dataset Format",
                    "singleTextOption": "Single Text",
                    "instructionInputOutputOption": "Instruction-Input-Output",
                    "questionAnswerOption": "Question-Answer",
                    "customOption": "Custom",
                    "customFormatLabel": "Custom Format",
                    "outputModelPathLabel": "Output Model Path",
                    "learningRateLabel": "Learning Rate",
                    "numEpochsLabel": "Number of Epochs",
                    "batchSizeLabel": "Batch Size",
                    "gradAccumStepsLabel": "Gradient Accumulation Steps",
                    "maxGradNormLabel": "Max Gradient Norm",
                    "weightDecayLabel": "Weight Decay",
                    "loraAlphaLabel": "LoRA Alpha",
                    "loraDropoutLabel": "LoRA Dropout",
                    "loraRLabel": "LoRA R",
                    "startTrainingButton": "Start Training",
                    "baseModelPathLabel": "Base Model Path",
                    "loraModelPathLabel": "LoRA Model Path",
                    "fusedOutputPathLabel": "Fused Output Path",
                    "startFusionButton": "Start Fusion",
                    "modelPathQuantizeLabel": "Model Path",
                    "quantizedOutputPathLabel": "Quantized Output Path",
                    "quantizationBitsLabel": "Quantization Bits",
                    "startQuantizationButton": "Start Quantization",
                    "progressTitle": "Progress"
                }
            },
            fr: {
                name: "Français",
                translations: {
                    "title": "Application de Fine-tuning LLM",
                    "trainButton": "Entraîner",
                    "fuseButton": "Fusionner",
                    "quantizeButton": "Quantifier",
                    "trainTitle": "Entraînement",
                    "fuseTitle": "Fusion",
                    "quantizeTitle": "Quantification",
                    "modelNameLabel": "Nom du modèle (chemin Hugging Face)",
                    "datasetSourceLabel": "Source du jeu de données",
                    "huggingFaceOption": "Hugging Face",
                    "localOption": "Local",
                    "datasetNameLabel": "Nom/Chemin du jeu de données",
                    "datasetFormatLabel": "Format du jeu de données",
                    "singleTextOption": "Texte simple",
                    "instructionInputOutputOption": "Instruction-Entrée-Sortie",
                    "questionAnswerOption": "Question-Réponse",
                    "customOption": "Personnalisé",
                    "customFormatLabel": "Format personnalisé",
                    "outputModelPathLabel": "Chemin du modèle de sortie",
                    "learningRateLabel": "Taux d'apprentissage",
                    "numEpochsLabel": "Nombre d'époques",
                    "batchSizeLabel": "Taille du lot",
                    "gradAccumStepsLabel": "Étapes d'accumulation du gradient",
                    "maxGradNormLabel": "Norme de gradient maximale",
                    "weightDecayLabel": "Décroissance des poids",
                    "loraAlphaLabel": "LoRA Alpha",
                    "loraDropoutLabel": "LoRA Dropout",
                    "loraRLabel": "LoRA R",
                    "startTrainingButton": "Commencer l'entraînement",
                    "baseModelPathLabel": "Chemin du modèle de base",
                    "loraModelPathLabel": "Chemin du modèle LoRA",
                    "fusedOutputPathLabel": "Chemin de sortie fusionné",
                    "startFusionButton": "Commencer la fusion",
                    "modelPathQuantizeLabel": "Chemin du modèle",
                    "quantizedOutputPathLabel": "Chemin de sortie quantifié",
                    "quantizationBitsLabel": "Bits de quantification",
                    "startQuantizationButton": "Commencer la quantification",
                    "progressTitle": "Progression"
                }
            }
        };

        const languageSelector = document.createElement('select');
        languageSelector.id = 'languageSelector';
        languageSelector.className = 'absolute top-4 right-4 bg-white border border-gray-300 text-gray-700 py-2 px-4 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500';
        document.body.appendChild(languageSelector);

        const localizer = new WebAppLocalizer(translations, 'llm_finetuning_app_', languageSelector);
        localizer.apply();
    </script>
</body>
</html>
