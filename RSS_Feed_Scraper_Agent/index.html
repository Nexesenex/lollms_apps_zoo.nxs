<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS News Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/lollms_assets/js/lollms_client_js"></script>
    <script src="/lollms_assets/js/axios.min"></script>
    <script src="/lollms_assets/js/web.app.localizer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-python.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="/lollms_assets/js/lollms_markdown_renderer"></script>
    <link rel="stylesheet" href="/lollms_assets/css/lollms_markdown_renderer">    
    <style>
        .chat-message {
            max-width: 70%;
            margin-bottom: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
        }
        .user-message {
            background-color: #e0e7ff;
            align-self: flex-end;
        }
        .ai-message {
            background-color: #f3e8ff;
            align-self: flex-start;
        }
        .blurred-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 50;
        }
        .settings-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            z-index: 100;
        }
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .strawberry {
            font-size: 64px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(-360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-r from-blue-100 to-purple-100 font-sans">
    <div class="container mx-auto px-4 py-8 h-screen flex flex-col">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-4xl font-bold text-indigo-800">RSS News Assistant</h1>
            <div class="flex items-center">
                <select id="languageSelector" class="mr-2 border border-indigo-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"></select>
                <button id="settingsBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded transition duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
                <button id="helpBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded transition duration-300 ml-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </button>
            </div>
        </div>
        <div class="mb-4 flex-grow flex flex-col">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex" aria-label="Tabs">
                    <a href="#" class="tab-btn border-indigo-500 text-indigo-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="rss">RSS Scraping</a>
                    <a href="#" id="chatTabSelector" class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm hidden" data-tab="chat">Chat</a>
                    <a href="#" id="reportTabSelector" class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="report">Report</a>
                    <a href="#" id="podcastTabSelector" class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="podcast">Podcast</a>
                </nav>
            </div>
            <div class="flex-grow flex">
                <div id="rssTab" class="tab-content w-full bg-white shadow-lg rounded-lg p-6 flex flex-col">
                    <h2 class="text-2xl font-semibold text-indigo-700 mb-4" data-translate="rss_feeds">RSS Feeds</h2>
                    <div class="mb-4">
                        <label for="presetSelector" class="block text-sm font-medium text-gray-700">Add custom RSS Feed</label>
                        <div class="flex flex-grow">
                            <input type="text" id="rssInput" data-translate="enter_rss_url" placeholder="Enter RSS feed URL" class="w-full border border-indigo-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <button id="addFeedBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition duration-300" data-translate="add_feed">Add Feed</button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="presetSelector" class="block text-sm font-medium text-gray-700">Select RSS Feed</label>
                        <div class="flex flex-grow">
                            <select id="presetSelector" class="w-full border border-indigo-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="">Choose an RSS feed</option>
                                <optgroup label="Technology">
                                    <option value="https://techcrunch.com/feed/">TechCrunch</option>
                                    <option value="https://rss.nytimes.com/services/xml/rss/nyt/Technology.xml">NY Times Technology</option>
                                    <option value="https://feeds.arstechnica.com/arstechnica/index">Ars Technica</option>
                                    <option value="https://www.wired.com/feed/rss">Wired</option>
                                    <option value="https://www.theverge.com/rss/index.xml">The Verge</option>
                                </optgroup>
                                <optgroup label="News">
                                    <option value="https://rss.cnn.com/rss/cnn_topstories.rss">CNN Top Stories</option>
                                    <option value="https://feeds.bbci.co.uk/news/rss.xml">BBC News</option>
                                    <option value="https://www.reuters.com/rss/topNews">Reuters Top News</option>
                                    <option value="https://rss.nytimes.com/services/xml/rss/nyt/World.xml">NY Times World News</option>
                                    <option value="https://www.npr.org/rss/rss.php?id=1001">NPR News</option>
                                </optgroup>
                                <optgroup label="Sports">
                                    <option value="https://www.espn.com/espn/rss/news">ESPN News</option>
                                    <option value="https://rss.nytimes.com/services/xml/rss/nyt/Sports.xml">NY Times Sports</option>
                                    <option value="https://www.skysports.com/rss/11095">Sky Sports</option>
                                    <option value="https://www.cbssports.com/rss/headlines/">CBS Sports</option>
                                    <option value="https://api.foxsports.com/v1/rss?partnerKey=zBaFxRyGKCfxBagJG9b8pqLyndmvo7UU">Fox Sports</option>
                                </optgroup>
                                <optgroup label="Entertainment">
                                    <option value="https://rss.nytimes.com/services/xml/rss/nyt/Movies.xml">NY Times Movies</option>
                                    <option value="https://www.hollywoodreporter.com/t/feed/">Hollywood Reporter</option>
                                    <option value="https://variety.com/feed/">Variety</option>
                                    <option value="https://www.rollingstone.com/feed/">Rolling Stone</option>
                                    <option value="https://ew.com/feed/">Entertainment Weekly</option>
                                </optgroup>
                                <optgroup label="Science">
                                    <option value="https://rss.nytimes.com/services/xml/rss/nyt/Science.xml">NY Times Science</option>
                                    <option value="https://www.sciencemag.org/rss/news_current.xml">Science Magazine</option>
                                    <option value="https://www.nature.com/nature.rss">Nature</option>
                                    <option value="https://feeds.nationalgeographic.com/ng/News/News_Main">National Geographic</option>
                                    <option value="https://www.space.com/feeds/all">Space.com</option>
                                </optgroup>
                                <optgroup label="Business">
                                    <option value="https://feeds.bloomberg.com/markets/news.rss">Bloomberg Markets</option>
                                    <option value="https://rss.nytimes.com/services/xml/rss/nyt/Business.xml">NY Times Business</option>
                                    <option value="https://www.forbes.com/real-time/feed2/">Forbes Real Time</option>
                                    <option value="https://www.ft.com/rss/home">Financial Times</option>
                                    <option value="https://www.wsj.com/xml/rss/3_7014.xml">Wall Street Journal</option>
                                </optgroup>
                            </select>
                            <button id="addPresetBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition duration-300">Add</button>    
</div>
                    </div>
                    
                    <div class="flex gap-2 mb-4">
                        <button id="startScrapingBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition duration-300" data-translate="start_scraping">Start Scraping</button>
                    </div>
                    <div id="feedList" class="space-y-2 flex-grow overflow-y-auto"></div>
                    <div id="feedContent" class="mt-4 flex-grow overflow-y-auto"></div>
                </div>
                <div id="chatTab" class="tab-content hidden w-full bg-white shadow-lg rounded-lg p-6 flex flex-col">
                    <h2 class="text-2xl font-semibold text-indigo-700 mb-4" data-translate="chat_with_lollms">Chat with Lollms</h2>
                    <div id="chatMessages" class="flex-grow overflow-y-auto mb-4 flex flex-col"></div>
                    <div class="flex gap-2">
                        <input type="text" id="userInput" data-translate="type_message" placeholder="Type your message..." class="flex-grow border border-indigo-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <button id="sendBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition duration-300" data-translate="send">Send</button>
                    </div>
                </div>
                <div id="reportTab" class="tab-content hidden w-full bg-white shadow-lg rounded-lg p-6 flex flex-col">
                    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">Report</h2>
                    <div id="reportContent" class="flex-grow overflow-y-auto"></div>
                    <div class="flex gap-2 mt-4">
                        <button id="generateReportBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition duration-300">Generate Report</button>
                        <button id="saveReportBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300">Save Report</button>
                    </div>
                </div>
                <div id="podcastTab" class="tab-content hidden w-full bg-white shadow-lg rounded-lg p-6 flex flex-col">
                    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">AI Podcast</h2>
                    <div id="podcastContent" class="flex-grow overflow-y-auto"></div>
                    <div class="flex gap-2 mt-4">
                        <button id="generatePodcastBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition duration-300">Generate Podcast</button>
                        <button id="savePodcastBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-300">Save Podcast</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="settingsOverlay" class="blurred-overlay"></div>
    <div id="settingsPopup" class="settings-popup">
        <h2 class="text-2xl font-semibold text-indigo-700 mb-4" data-translate="settings">Settings</h2>
        <div class="mb-4">
            <label for="ctxSizeInput" class="block text-sm font-medium text-gray-700">Context Size</label>
            <input type="number" id="ctxSizeInput" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
        </div>
        <div class="mb-4">
            <label for="hostAddressInput" class="block text-sm font-medium text-gray-700">Host Address</label>
            <input type="text" id="hostAddressInput" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
        </div>
        <div class="mb-4">
            <label for="podcastHost1Input" class="block text-sm font-medium text-gray-700">Podcast Host 1</label>
            <input type="text" id="podcastHost1Input" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
        </div>
        <div class="mb-4">
            <label for="podcastHost2Input" class="block text-sm font-medium text-gray-700">Podcast Host 2</label>
            <input type="text" id="podcastHost2Input" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
        </div>
        <button id="closeSettingsBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition duration-300" data-translate="close">Close</button>
    </div>
    <div id="helpOverlay" class="blurred-overlay"></div>
    <div id="helpPopup" class="settings-popup">
        <h2 class="text-2xl font-semibold text-indigo-700 mb-4">Help</h2>
        <div class="mb-4 overflow-y-auto max-h-96">
            <h3 class="text-xl font-semibold mb-2">RSS Scraping</h3>
            <p>1. Add RSS feeds using the input field or select from presets.</p>
            <p>2. Click "Start Scraping" to fetch the latest content.</p>
            <p>3. View scraped content in the feed list.</p>
            
            <h3 class="text-xl font-semibold mt-4 mb-2">Chat</h3>
            <p>1. After scraping, click on the "Chat" tab.</p>
            <p>2. Type your questions about the news in the input field.</p>
            <p>3. Click "Send" or press Enter to get AI-generated responses.</p>
            
            <h3 class="text-xl font-semibold mt-4 mb-2">Report</h3>
            <p>1. Go to the "Report" tab after scraping content.</p>
            <p>2. Click "Generate Report" for an AI-generated summary of the news.</p>
            <p>3. Click "Save Report" to download the generated report.</p>
            
            <h3 class="text-xl font-semibold mt-4 mb-2">Podcast</h3>
            <p>1. Navigate to the "Podcast" tab after scraping content.</p>
            <p>2. Click "Generate Podcast" to create an AI-generated podcast discussion.</p>
            <p>3. Click "Save Podcast" to download the generated podcast script.</p>
            
            <h3 class="text-xl font-semibold mt-4 mb-2">Settings</h3>
            <p>1. Click the gear icon to open settings.</p>
            <p>2. Adjust the context size and host address as needed.</p>
            <p>3. Set the names for the podcast hosts.</p>
            <p>4. Click "Close" to save changes.</p>
        </div>
        <button id="closeHelpBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition duration-300">Close</button>
    </div>
    <div id="loadingOverlay" class="loading">
        <div class="text-center">
            <div class="strawberry">🍓</div>
            <div class="mt-4 text-indigo-800">Interrogating LOLLMS strawberry...</div>
        </div>
    </div>
    <script>
        const mr = new MarkdownRenderer()
        const translations = {
            en: {
                name: "English",
                translations: {
                    "rss_feeds": "RSS Feeds",
                    "enter_rss_url": "Enter RSS feed URL",
                    "add_feed": "Add Feed",
                    "start_scraping": "Start Scraping",
                    "chat_with_lollms": "Chat with Lollms",
                    "type_message": "Type your message...",
                    "send": "Send",
                    "settings": "Settings",
                    "language": "Language",
                    "close": "Close"
                },
                promptTranslations: {
                    "system_prompt": "You are an AI assistant that helps users understand news articles scraped from rss feeds. Your responses should be informative and concise. When referencing news articles, use the format [Article Title](Article Link) to create clickable links. Use markdown format for answering the questions.",
                    "user_prompt": "Hello! Can you tell me about the latest news?",
                    "system_report_prompt": "You are an AI assistant that generates comprehensive reports based on scraped RSS feed content. Your task is to analyze the provided news articles and create a detailed report with proper citations. Use markdown format for the report, including headers, bullet points, and links to sources.",
                    "system_podcast_prompt": "You are an AI that generates a podcast discussion between two AI hosts named {host1} and {host2}. Create an engaging conversation about the latest news from the scraped RSS feeds. Use markdown format for the podcast script, clearly indicating the speaker for each line of dialogue."
                }
            },
            fr: {
                name: "Français",
                translations: {
                    "rss_feeds": "Flux RSS",
                    "enter_rss_url": "Entrez l'URL du flux RSS",
                    "add_feed": "Ajouter",
                    "start_scraping": "Commencer",
                    "chat_with_lollms": "Discuter avec Lollms",
                    "type_message": "Tapez votre message...",
                    "send": "Envoyer",
                    "settings": "Paramètres",
                    "language": "Langue",
                    "close": "Fermer"
                },
                promptTranslations: {
                    "system_prompt": "Vous êtes un assistant IA qui aide les utilisateurs à comprendre les articles d'actualité. Vos réponses doivent être informatives et concises. Lorsque vous faites référence à des articles d'actualité, utilisez le format [Titre de l'article](Lien de l'article) pour créer des liens cliquables. Utilise le markdown comme format de réponses.",
                    "user_prompt": "Bonjour ! Pouvez-vous me parler des dernières actualités ?",
                    "system_report_prompt": "Vous êtes un assistant IA qui génère des rapports complets basés sur le contenu des flux RSS collectés. Votre tâche consiste à analyser les articles d'actualité fournis et à créer un rapport détaillé avec des citations appropriées. Utilisez le format markdown pour le rapport, incluant des en-têtes, des puces, et des liens vers les sources.",
                    "system_podcast_prompt": "Vous êtes une IA qui génère une discussion de podcast entre deux animateurs IA nommés {host1} et {host2}. Créez une conversation engageante sur les dernières nouvelles des flux RSS collectés. Utilisez le format markdown pour le script du podcast, en indiquant clairement le locuteur pour chaque ligne de dialogue."
                }
            }
        };
        const localizer = new WebAppLocalizer(translations, "rssNewsAssistant", document.getElementById("languageSelector"));
        localizer.apply();
        const lc = new LollmsClient();
        let rssFeeds = JSON.parse(localStorage.getItem('rssFeeds')) || [];
        let scrapedContent = JSON.parse(localStorage.getItem('scrapedContent')) || [];
        let scrapedMarkdown = "";
        let podcastHost1 = localStorage.getItem('podcastHost1') || "Dave";
        let podcastHost2 = localStorage.getItem('podcastHost2') || "Rebecca";
        function showLoader() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        function hideLoader() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        async function addFeed() {
            const feedUrl = document.getElementById("rssInput").value.trim();
            if (feedUrl && !rssFeeds.includes(feedUrl)) {
                rssFeeds.push(feedUrl);
                document.getElementById("rssInput").value = "";
                updateFeedList();
                localStorage.setItem('rssFeeds', JSON.stringify(rssFeeds));
            }
        }
        function addSelectedFeed() {
            const selectedFeed = document.getElementById("presetSelector").value;
            if (selectedFeed) {
                if (!rssFeeds.includes(selectedFeed)) {
                    rssFeeds.push(selectedFeed);
                    updateFeedList();
                    localStorage.setItem('rssFeeds', JSON.stringify(rssFeeds));
                } else {
                    alert("This feed is already in your list.");
                }
            }
        }
        function updateFeedList() {
            const feedList = document.getElementById("feedList");
            feedList.innerHTML = "";
            rssFeeds.forEach((feed, index) => {
                const feedItem = document.createElement("div");
                feedItem.className = "flex justify-between items-center bg-indigo-100 p-2 rounded";
                feedItem.innerHTML = `
                    <span>${feed}</span>
                    <button class="text-red-600 hover:text-red-800" onclick="removeFeed(${index})">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                    </button>
                `;
                feedList.appendChild(feedItem);
            });
        }
        function removeFeed(index) {
            rssFeeds.splice(index, 1);
            updateFeedList();
            localStorage.setItem('rssFeeds', JSON.stringify(rssFeeds));
        }
async function startScraping() {
            if (rssFeeds.length === 0) return;
            showLoader();
            try {
                const response = await fetch("http://localhost:8000/get_rss_content", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ urls: rssFeeds }),
                });
                if (!response.ok) {
                    throw new Error("Failed to fetch RSS content");
                }
                scrapedContent = await response.json();
                scrapedMarkdown = convertScrapedContentToMarkdown();
                displayScrapedContent();
                document.querySelector('[data-tab="chat"]').click();
                document.getElementById("chatTabSelector").classList.remove("hidden");
                localStorage.setItem('scrapedContent', JSON.stringify(scrapedContent));
            } catch (error) {
                console.error("Error scraping RSS feeds:", error);
            } finally {
                hideLoader();
            }
        }
        function convertScrapedContentToMarkdown() {
            let markdown = "";
            scrapedContent.forEach(feed => {
                markdown += `## ${feed.feed_url}\n\n`;
                feed.items.forEach(item => {
                    markdown += `### [${item.title}](${item.link})\n\n`;
                    if (item.published) {
                        markdown += `**Published:** ${item.published}\n\n`;
                    }
                    if (item.description) {
                        markdown += `${item.description}\n\n`;
                    }
                    markdown += `---\n\n`;
                });
                markdown += "\n";
            });
            return markdown;
        }
        function displayScrapedContent() {
            const feedContent = document.getElementById("feedContent");
            feedContent.innerHTML = "";
            scrapedContent.forEach(feed => {
                const feedDiv = document.createElement("div");
                feedDiv.className = "mb-4";
                feedDiv.innerHTML = `<h3 class="font-bold text-indigo-700">${feed.feed_url}</h3>`;
                const itemsList = document.createElement("ul");
                itemsList.className = "list-disc pl-5";
                feed.items.forEach(item => {
                    const listItem = document.createElement("li");
                    listItem.innerHTML = `<a href="${item.link}" target="_blank" class="text-blue-600 hover:underline">${item.title}</a>`;
                    itemsList.appendChild(listItem);
                });
                feedDiv.appendChild(itemsList);
                feedContent.appendChild(feedDiv);
            });
        }
        async function sendMessage() {
            const userInput = document.getElementById("userInput");
            const message = userInput.value.trim();
            if (!message) return;
            addMessageToChat("user", message);
            userInput.value = "";
            showLoader();
            try {
                const systemPrompt = localizer.formatPrompt("system_prompt");
                const prompt = `${lc.system_message()}${systemPrompt}${lc.template.separator_template}${lc.user_message()}${message}${lc.template.separator_template}${lc.user_message("Rss feed search results")}${scrapedMarkdown}${lc.template.separator_template}${lc.ai_message()}`;
                const response = await lc.generate(prompt);
                addMessageToChat("ai", response);
            } catch (error) {
                console.error("Error generating response:", error);
                addMessageToChat("ai", "I'm sorry, I encountered an error while processing your request.");
            } finally {
                hideLoader();
            }
        }
        async function addMessageToChat(sender, content) {
            const chatMessages = document.getElementById("chatMessages");
            const messageDiv = document.createElement("div");
            messageDiv.className = `chat-message ${sender}-message`;
            messageDiv.innerHTML = await mr.renderMarkdown(content);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        async function generateReport() {
            showLoader();
            try {
                const systemPrompt = localizer.formatPrompt("system_report_prompt");
                const prompt = `${lc.system_message()}${systemPrompt}${lc.template.separator_template}${lc.template.separator_template}${lc.user_message("Rss feed search results")}${scrapedMarkdown}${lc.template.separator_template}Important: The report must be generated in ${localizer.currentLang}. Answer with the report without any comment.${lc.template.separator_template}${lc.ai_message()}`;
                const response = await lc.generate(prompt);
                const reportContent = document.getElementById("reportContent");
                reportContent.innerHTML = await mr.renderMarkdown(response);
                document.querySelector('[data-tab="report"]').click();
            } catch (error) {
                console.error("Error generating report:", error);
                alert("An error occurred while generating the report. Please try again.");
            } finally {
                hideLoader();
            }
        }
        async function generatePodcast() {
            showLoader();
            try {
                const systemPrompt = localizer.formatPrompt("system_podcast_prompt", {
                    host1: podcastHost1,
                    host2: podcastHost2
                });
                const prompt = `${lc.system_message()}${systemPrompt}${lc.template.separator_template}${lc.template.separator_template}${lc.user_message("Rss feed search results")}${scrapedMarkdown}${lc.template.separator_template}Important: The podcast must be generated in ${localizer.currentLang}. Answer with the podcast script without any comment.${lc.template.separator_template}${lc.ai_message()}`;
                const response = await lc.generate(prompt);
                const podcastContent = document.getElementById("podcastContent");
                podcastContent.innerHTML = await mr.renderMarkdown(response);
                document.querySelector('[data-tab="podcast"]').click();
            } catch (error) {
                console.error("Error generating podcast:", error);
                alert("An error occurred while generating the podcast. Please try again.");
            } finally {
                hideLoader();
            }
        }
        function saveReport() {
            const reportContent = document.getElementById("reportContent").innerText;
            const blob = new Blob([reportContent], { type: "text/plain;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "news_report.md";
            link.click();
            URL.revokeObjectURL(url);
        }
        function savePodcast() {
            const podcastContent = document.getElementById("podcastContent").innerText;
            const blob = new Blob([podcastContent], { type: "text/plain;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "news_podcast.md";
            link.click();
            URL.revokeObjectURL(url);
        }
        document.getElementById("addFeedBtn").addEventListener("click", addFeed);
        document.getElementById("addPresetBtn").addEventListener("click", addSelectedFeed);
        document.getElementById("startScrapingBtn").addEventListener("click", startScraping);
        document.getElementById("sendBtn").addEventListener("click", sendMessage);
        document.getElementById("generateReportBtn").addEventListener("click", generateReport);
        document.getElementById("saveReportBtn").addEventListener("click", saveReport);
        document.getElementById("generatePodcastBtn").addEventListener("click", generatePodcast);
        document.getElementById("savePodcastBtn").addEventListener("click", savePodcast);
        document.getElementById("userInput").addEventListener("keypress", (e) => {
            if (e.key === "Enter") sendMessage();
        });
        const settingsOverlay = document.getElementById("settingsOverlay");
        const settingsPopup = document.getElementById("settingsPopup");
        const closeSettingsBtn = document.getElementById("closeSettingsBtn");
        const settingsBtn = document.getElementById("settingsBtn");
        const ctxSizeInput = document.getElementById("ctxSizeInput");
        const hostAddressInput = document.getElementById("hostAddressInput");
        const podcastHost1Input = document.getElementById("podcastHost1Input");
        const podcastHost2Input = document.getElementById("podcastHost2Input");
        const helpOverlay = document.getElementById("helpOverlay");
        const helpPopup = document.getElementById("helpPopup");
        const helpBtn = document.getElementById("helpBtn");
        const closeHelpBtn = document.getElementById("closeHelpBtn");
        function toggleSettings() {
            settingsOverlay.style.display = settingsOverlay.style.display === "none" ? "block" : "none";
            settingsPopup.style.display = settingsPopup.style.display === "none" ? "block" : "none";
        }
        function toggleHelp() {
            helpOverlay.style.display = helpOverlay.style.display === "none" ? "block" : "none";
            helpPopup.style.display = helpPopup.style.display === "none" ? "block" : "none";
        }
        function updateSettings() {
            const ctxSize = parseInt(ctxSizeInput.value);
            const hostAddress = hostAddressInput.value.trim();
            podcastHost1 = podcastHost1Input.value.trim() || "Dave";
            podcastHost2 = podcastHost2Input.value.trim() || "Rebecca";
            if (ctxSize) {
                lc.updateSettings({ ctx_size: ctxSize });
            }
            if (hostAddress) {
                lc.updateSettings({ host_address: hostAddress });
            }
            localStorage.setItem('podcastHost1', podcastHost1);
            localStorage.setItem('podcastHost2', podcastHost2);
        }
        function loadSettings() {
            ctxSizeInput.value = lc.ctx_size || 4096;
            hostAddressInput.value = lc.host_address || "http://localhost:9600";
            podcastHost1Input.value = podcastHost1;
            podcastHost2Input.value = podcastHost2;
        }
        settingsBtn.addEventListener("click", () => {
            loadSettings();
            toggleSettings();
        });
        closeSettingsBtn.addEventListener("click", () => {
            updateSettings();
            toggleSettings();
        });
        helpBtn.addEventListener("click", toggleHelp);
        closeHelpBtn.addEventListener("click", toggleHelp);
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.getAttribute('data-tab');
                tabButtons.forEach(btn => btn.classList.remove('border-indigo-500', 'text-indigo-600'));
                tabContents.forEach(content => content.classList.add('hidden'));
                button.classList.add('border-indigo-500', 'text-indigo-600');
                document.getElementById(`${tabName}Tab`).classList.remove('hidden');
            });
        });
        hideLoader();
        updateFeedList();
        displayScrapedContent();
        document.querySelector('[data-tab="rss"]').click();
    </script>
</body>
</html>